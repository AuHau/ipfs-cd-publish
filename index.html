



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Publish your static webpages directly from Git - automatically!">
      
      
      
        <meta name="author" content="Adam Uhlíř">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>IPFS Publish - Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#fb8c00">
      
    
    
      <script src="assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="stylesheets/one-page.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-69422360-3", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="orange" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#welcome-to-ipfs-publish" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="IPFS Publish - Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">power_settings_new</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              IPFS Publish - Documentation
            </span>
            <span class="md-header-nav__topic">
              Home
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/auhau/ipfs-publish/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    auhau/ipfs-publish
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="IPFS Publish - Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">power_settings_new</i>
      
    </a>
    IPFS Publish - Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/auhau/ipfs-publish/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    auhau/ipfs-publish
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" title="About" class="md-nav__link">
    About
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pip" title="pip" class="md-nav__link">
    pip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" title="Docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables-overview" title="Environment variables overview" class="md-nav__link">
    Environment variables overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishing-flow" title="Publishing flow" class="md-nav__link">
    Publishing flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignore-files" title="Ignore files" class="md-nav__link">
    Ignore files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-binary" title="Building binary" class="md-nav__link">
    Building binary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-publish-binary" title="After-publish binary" class="md-nav__link">
    After-publish binary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishing-sub-directory" title="Publishing sub-directory" class="md-nav__link">
    Publishing sub-directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specific-branch-to-publish" title="Specific branch to publish" class="md-nav__link">
    Specific branch to publish
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" title="About" class="md-nav__link">
    About
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pip" title="pip" class="md-nav__link">
    pip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" title="Docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables-overview" title="Environment variables overview" class="md-nav__link">
    Environment variables overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishing-flow" title="Publishing flow" class="md-nav__link">
    Publishing flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignore-files" title="Ignore files" class="md-nav__link">
    Ignore files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-binary" title="Building binary" class="md-nav__link">
    Building binary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-publish-binary" title="After-publish binary" class="md-nav__link">
    After-publish binary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishing-sub-directory" title="Publishing sub-directory" class="md-nav__link">
    Publishing sub-directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specific-branch-to-publish" title="Specific branch to publish" class="md-nav__link">
    Specific branch to publish
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/auhau/ipfs-publish/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="welcome-to-ipfs-publish">Welcome to IPFS Publish!<a class="headerlink" href="#welcome-to-ipfs-publish" title="Permanent link">&para;</a></h1>
<p><img alt="Git+IPFS=Love" src="assets/love.png" /></p>
<h2 id="about">About<a class="headerlink" href="#about" title="Permanent link">&para;</a></h2>
<p>This is a tool that aims to enable automatic publishing of static webpages from Git repositories into IPFS. 
It consists of two parts: small web server and management CLI.</p>
<p>Web server exposes an endpoint which you use as your Git's webhook. When the hook is invoked, it clones
your repo, build it (if needed), add it to the IPFS node (pin it if configured) and publish the new IPFS address
under configured IPNS name.</p>
<p>CLI is in place to manage the repos.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>Python 3.7 and higher</li>
<li>Git</li>
<li>go-ipfs daemon</li>
<li>UNIX-Like machine with public IP</li>
</ul>
<p>!!! warning 'Web server warning'
    This tool is shipped with a basic web server that is mainly meant for a development environment 
    and is a single-threaded based, hence it is not meant for heavy load. As I am not expecting 
    that this tool would scale big it should be sufficient to use. If you would have the need you can 
    deploy it with some production-scale webserver that supports the <code>ASGI</code> protocol. The <code>ASGI</code> app
    can be found in <code>publish.http:app</code> package.</p>
<h3 id="pip">pip<a class="headerlink" href="#pip" title="Permanent link">&para;</a></h3>
<p>You can install ipfs-publish directly on your machine using <code>pip</code>:</p>
<div class="codehilite"><pre><span></span>$ pip install ipfs-publish
</pre></div>

<p>Then you can use the command <code>ipfs-publish</code> to manage your repos and/or start the webhook's server.</p>
<div class="admonition tip">
<p class="admonition-title">Service definition</p>
<p>Depanding on your OS, you can create a systemd service for running the webhook's server. It will handle restarting
the service, and provides easy way how to manage it:</p>
<div class="codehilite"><pre><span></span>[Unit]
Description=ipfs-publish webhook server
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=always
RestartSec=1
User=&lt;&lt;your user&gt;&gt;
ExecStart=ipfs-publish server

[Install]
WantedBy=multi-user.target
</pre></div>

</div>
<h3 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h3>
<p>If you plan to let some other users to use your ipfs-publish instance, then it might be good idea to run it inside
Docker, for at least some level isolation from rest of your system. <strong>But it is bit more complicated to setup.</strong></p>
<p>There is automatically build official Docker image: <code>auhau/ipfs-publish</code>. The image exposes port 8080, under which the 
webhook server is listening for incoming connections. And volume on path <code>/data/ipfs_publish/</code> to persist the configuration. 
This image does not have IPFS daemon, therefore you have to provide connectivity to the daemon of your choice. </p>
<div class="admonition info">
<p class="admonition-title">go-ipfs verion</p>
<p>ipfs-publish is tested with go-ipfs version <strong>v0.4.18</strong>, using different versions might result in unexpected behaviour!</p>
</div>
<p>Easiest way to deploy ipfs-publish is using <code>docker-compose</code>, together with <code>go-ipfs</code> as container. 
You can use this YAML configuration for it:</p>
<div class="codehilite"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3&#39;</span>

<span class="nt">services</span><span class="p">:</span>
  <span class="nt">ipfs</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ipfs/go-ipfs:v0.4.18</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/data/ipfs</span> <span class="c1"># or you can mount it directly to some directory on your system</span>
  <span class="nt">ipfs-publish</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">auhau/ipfs-publish</span>
    <span class="nt">environment</span><span class="p">:</span>
      <span class="nt">IPFS_PUBLISH_CONFIG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/ipfs_publish/config.toml</span>
      <span class="nt">IPFS_PUBLISH_VERBOSITY</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="nt">IPFS_PUBLISH_IPFS_HOST</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ipfs</span>
      <span class="nt">IPFS_PUBLISH_IPFS_PORT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5001</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/data/ipfs_publish</span>
    <span class="nt">depends_on</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ipfs</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">8080:8000</span>
</pre></div>

<p>Also you can deploy it as a standalone image using <code>docker</code>, but it requires some more configuration based on your use-case. 
If you have running IPFS daemon on the host like this:</p>
<div class="codehilite"><pre><span></span>$ docker run -e <span class="nv">IPFS_PUBLISH_CONFIG</span><span class="o">=</span>/data/ipfs_publish/config.toml
 -e <span class="nv">IPFS_PUBLISH_IPFS_HOST</span><span class="o">=</span>localhost -e <span class="nv">IPFS_PUBLISH_IPFS_PORT</span><span class="o">=</span><span class="m">5001</span> --network<span class="o">=</span><span class="s2">&quot;host&quot;</span> auhau/ipfs_publish
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Host network</p>
<p><code>--network="host"</code> will bind the container's ports directly to the machine exposing it to the world, so be careful
with that! With this configuration you can use <code>localhost</code> address which will address the host machine.</p>
<p><strong>Be aware that this mode does not work on macOS!</strong></p>
</div>
<div class="admonition tip">
<p class="admonition-title">Non-host network approach</p>
<p>If you don't want to use the <code>--network="host"</code> mode, you can achieve similar behaviour if you set 
<code>IPFS_PUBLISH_IPFS_HOST=$HOST_ADDR</code>. <code>HOST_ADDR</code> is a special environment variable, that
is set inside the container and is resolved to IP address under which the host machine is reachable.</p>
<div class="admonition warning">
<p class="admonition-title">IPFS Daemon API restriction</p>
<p>By default the Daemon API is listening only for connection from localhost. If you want to run the IPFS Daemon
on the host and connect to it from container as described before, then you have to configure the IPFS Daemon 
to listen to correct address. </p>
</div>
</div>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Upon the first invocation of the command <code>ipfs-publish</code>, you are asked to specify some general configuration, like
how to connect to the IPFS daemon etc. This process will create the config file. </p>
<div class="admonition info">
<p class="admonition-title">Default config file placement</p>
<p>The default placement of the ipfs-publish's config is on path: <code>~/.ipfs_publish.toml</code></p>
</div>
<div class="admonition tip">
<p class="admonition-title">Specific config's placement</p>
<p>You can use different path where the config's is to be stored using either the environment variable <code>IPFS_PUBLISH_CONFIG</code>
or the <code>ipfs-publish --config &lt;path&gt;</code> option.</p>
</div>
<p>For available CLI commands see the <code>--help</code> page. Basic overview of usage of the CLI:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Add new repo</span>
$ ipfs-publish add
<span class="o">[</span>?<span class="o">]</span> Git URL of the repo: https://github.com/auhau/auhau.github.io
<span class="o">[</span>?<span class="o">]</span> Name of the new repo: github_com_auhau_auhau_github_io
<span class="o">[</span>?<span class="o">]</span> Do you want to check-out specific branch?: &lt;default-branch&gt;
<span class="o">[</span>?<span class="o">]</span> Do you want to publish to IPNS? <span class="o">(</span>Y/n<span class="o">)</span>:
<span class="o">[</span>?<span class="o">]</span> Path to build binary, <span class="k">if</span> you want to <span class="k">do</span> some pre-processing before publishing:
<span class="o">[</span>?<span class="o">]</span> Path to after-publish binary, <span class="k">if</span> you want to <span class="k">do</span> some actions after publishing:
<span class="o">[</span>?<span class="o">]</span> Directory to be published inside the repo. Path related to the root of the repo: /

Successfully added new repo!
Use this URL <span class="k">for</span> you webhook: http://localhost:8080/publish/github_com_auhau_auhau_github_io
Also <span class="nb">set</span> this string as your hook<span class="err">&#39;</span>s Secret: NIHT4785CVFT358GFE08RDAZG
Your IPNS address: /ipns/QmRTqaW3AJJXmKyiNT7MqqZ4VjGtNNxPyTkgo3Q7pmoCeX/

<span class="c1"># List current enabled repos</span>
$ ipfs-publish list
github_com_auhau_auhau_github_io

<span class="c1"># Show details of repo</span>
$ ipfs-publish show github_com_auhau_auhau_github_io
github_com_auhau_auhau_github_io
Git URL: https://github.com/auhau/auhau.github.io
Secret: EAHJ43UYT7LUEM4QFRZ4IFAXL
IPNS key: ipfs_publishg_github_com_auhau_auhau_github_io
IPNS lifetime: 24h
IPNS ttl: 15m
IPNS address: /ipns/QmRTqaW3AJJXmKyiNT7MqqZ4VjGtNNxPyTkgo3Q7pmoCeX/
Last IPFS address: None
Webhook address: http://localhost:8080/publish/github_com_auhau_auhau_github_io

<span class="c1"># You can manually publish repo</span>
$ ipfs-publish publish github_com_auhau_auhau_github_io

<span class="c1"># Starts HTTP server &amp; IPNS republishing service</span>
$ ipfs-publish server <span class="p">&amp;</span>
Running on http://localhost:8080 <span class="o">(</span>CTRL + C to quit<span class="o">)</span>
</pre></div>

<h3 id="environment-variables-overview">Environment variables overview<a class="headerlink" href="#environment-variables-overview" title="Permanent link">&para;</a></h3>
<ul>
<li><code>IPFS_PUBLISH_VERBOSITY</code> (int) - specifies verbosity level, same like the <code>-vvv</code> option.</li>
<li><code>IPFS_PUBLISH_EXCEPTIONS</code> (bool) - if <code>True</code> then any exceptions raised are not handled by the CLI (mostly for testing).</li>
<li><code>IPFS_PUBLISH_CONFIG</code> (str) - path to where the config file will be looked for.</li>
<li><code>IPFS_PUBLISH_IPFS_HOST</code> (str) - hostname where IPFS HTTP API will connect to.</li>
<li><code>IPFS_PUBLISH_IPFS_PORT</code> (int) - port which will be used for IPFS HTTP API connection.</li>
</ul>
<h3 id="publishing-flow">Publishing flow<a class="headerlink" href="#publishing-flow" title="Permanent link">&para;</a></h3>
<p>When repo is being published it follows these steps:</p>
<ol>
<li>Freshly clone the Git repo into temporary directory, the default branch is checked out.</li>
<li>If <code>build_bin</code> is defined, it is executed inside root of the repo.</li>
<li>The <code>.git</code> folder is removed and if the <code>.ipfs_publish_ignore</code> file is present in root of the repo, the files 
specified in the file are removed.</li>
<li>The old pinned version is unpinned.</li>
<li>If <code>publish_dir</code> is specified, then this folder is added and pinned (if configured) to IPFS, otherwise the root of the repo is added.</li>
<li>If publishing to IPNS is configured, the IPNS entry is updated.</li>
<li>If <code>after_publish_bin</code> is defined, then it is executed inside root of the repo and the added IPFS hash is passed as argument.</li>
<li>Cleanup of the repo.</li>
</ol>
<h3 id="ignore-files">Ignore files<a class="headerlink" href="#ignore-files" title="Permanent link">&para;</a></h3>
<p>ipfs-publish can remove files before publishing the repo to IPFS. It works similarly like <code>.gitignore</code> except, that it
follows the Python's <a href="https://docs.python.org/3/library/glob.html">glob's syntax</a>, that is similar to UNIX style glob.
Hence usage of <code>**</code> is required if you want to remove files from subdirectories.</p>
<p>The definition of which files should be removed has to be placed in root of the repo with filename <code>.ipfs_publish_ignore</code>.</p>
<h3 id="building-binary">Building binary<a class="headerlink" href="#building-binary" title="Permanent link">&para;</a></h3>
<p>ipfs-publish allows you to run binary before publishing the repo. This feature can be used to build the repo before publishing it.
The binary is invoked in root of the repository and it needs to be installed and accessible to the OS user that is running
the webhook's server. It is invoked with shell, so shell's capabilities are available.</p>
<p>The binary can be specified during the bootstrapping of the repo using CLI , or later on added into the config file under "execute" subsection
of the repo's configuration: <code>[repos.&lt;name of repo&gt;.execute]</code> under name <code>build_bin</code>. Example:</p>
<div class="codehilite"><pre><span></span>[repos.github_com_auhau_auhau_github_io.execute]
build_bin = &quot;jekyll build&quot;
</pre></div>

<h3 id="after-publish-binary">After-publish binary<a class="headerlink" href="#after-publish-binary" title="Permanent link">&para;</a></h3>
<p>Similarly to building binary, there is also support for running a command after publishing to the IPFS. This can be
used for example to directly set the IPFS hash to your dns_link TXT record and not depend on IPNS. The published
IPFS address is passed as a argument to the binary.</p>
<p>The binary can be specified during the bootstrapping of the repo using CLI , or later on added into the config file under "execute" subsection
of the repo's configuration: <code>[repos.&lt;name of repo&gt;.execute]</code> under name <code>after_publish_bin</code>. Example:</p>
<div class="codehilite"><pre><span></span>[repos.github_com_auhau_auhau_github_io.execute]
after_publish_bin = &quot;update-dns.sh&quot;
</pre></div>

<h3 id="publishing-sub-directory">Publishing sub-directory<a class="headerlink" href="#publishing-sub-directory" title="Permanent link">&para;</a></h3>
<p>ipfs-publish enables you to publish only part of the repo, by specifying the <code>publish_dir</code> parameter. This can be used
together with the building binary to publish only the build site sub-folder.</p>
<h3 id="specific-branch-to-publish">Specific branch to publish<a class="headerlink" href="#specific-branch-to-publish" title="Permanent link">&para;</a></h3>
<p>You can configure specific branch in your Git repo that should be published. You can do so during adding adding the 
repo, or later on adding <code>branch=&lt;name&gt;</code> to the config:</p>
<div class="codehilite"><pre><span></span>[repos.github_com_auhau_auhau_github_io]
branch = &quot;gh-pages&quot;
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 <a href="https://www.adam-uhlir.me">Adam Uhlíř</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>